<!DOCTYPE html>
<meta charset="utf-8">
<head>
    
<title>Paul's "Read the World" tracker</title>
    
    <meta property="og:description" content="Interactive map tracking Paul's journey to read (and travel) the world." />
    <meta property="og:image" content="http://paulkaefer.com/read-the-world/map.png" />
    <meta name="theme-color" content="#011AFF" class="mobile_tab_color">
    
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAtCAYAAAA6GuKaAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAKFSURBVGhD1ZitblVREIVPAg0JCWlCCA4PBoMpyBqCA4MFA09QxxNUEjSmggfqG9T1LW6ZkJWuO+c7s/f5EQfxia41s2c6ney7e4fh6vbw34Hi3kFx76C4d1B0Lv4chmcv/gYOY0L/9pPzhPJ7YntBMYhir94dhidPx806J4/qZk6fH8dSzFxQDFTswcP7olNUzXjc+ReOITQ0GshIEF6M/M8/jmPiZ4rzGPKJaPjx6b8cGshIED3F3n+/j5mads85GV8pyhsJokoSv2/acS2f8BxaqZEgPJF80Ypr+Zmvl+0cFINWooi1UBztde85wlfj7CPHoBj0Fmvtde85waeL4/hYP4pDMfBk8kVrryvPyWsxNeUAxcAPIN+pYitP+BUXvD6fnnKAYtBTTFSxlSfyFVc1HKAY+CHki5hSFVt5QV6Lnk9NFAM/qPdtEWS/8uJcX4tqjx0UA7/Kpj7teqbkvrT469DLsbUWAsUgvy2y3zMl+qDIeWLOYwpFkQ+uoCn56rx8y9ONX7Z3wgJFkQtMMTUlinXmTNdBUVAhp5pSvlWcJdN1UBReiPyKfKuIpdN1UBRejPwKzxVT/yjMBUXhBcmv8FwRV2d15/eCovCC5Fd4br7z1zaOovDC5Fd4br7z1zaOovBC5Ffk3C0bR1F4EfIrKHerxlEUXoD8iqncLRpHUfjh5FdUuWsbRzFovZNbtHLXNI5i0Hont+jJpcYpLoNi4Ict+ej1fPJFbjx+pjgHxbWrEczJz19DtNYExbWr0fMtkRMvvmhW8a01QdEPWLIa/tjv/b8vrwnFCBR1wNJnpL4pevNh3ru5ty6KW/DrmvUtQHHvoLh3UNw7KO4dFHfN7eEOTk1vbe3WgDkAAAAASUVORK5CYII=">
    <link rel="stylesheet" type="text/css" href="http://paulkaefer.com/stylesheet.css">

    <link rel="stylesheet" type="text/css" href="read_the_world.css">
    
<!-- make the table sortable: -->
<script src="http://paulkaefer.com/scripts/sorttable.js"></script>

</head>

<body>
<center><h1>Paul's "Read the World" tracker</h1>
    <div style="width:60%;"><p><em style="opacity:0.5;">"Travel is fatal to prejudice, bigotry, and narrow-mindedness, and many of our people need it sorely on these accounts. Broad, wholesome, charitable views of men and things cannot be acquired by vegetating in one little corner of the earth all one's lifetime."<br>&ndash; Mark Twain</em></em></p></div>

<p>Inspired by a friend I met in Tanzania and <a href="http://www.ted.com/talks/ann_morgan_my_year_reading_a_book_from_every_country_in_the_world" target=_blank>this TED talk</a>.<br>See also <a href="https://www.theguardian.com/books/2013/oct/15/neil-gaiman-future-libraries-reading-daydreaming" target=_blank>this excellent piece on reading, libraries, and the power of fiction to teach empathy</a>.
    <br><br>I welcome you to <a href="https://github.com/paulkaefer/read-the-world" target=_blank>use my code or submit a reading suggestion</a>!</p>

<br>
<h2 style="font-size:20px;font-family:Helvetica;opacity:0.5;">Hover for country names and books; scroll down to see my lists</h2>
<map></map>

<br><br><br>
<h2>Books I've completed reading:</h2>
<h3 id="expand0" style="opacity:0.5;" onclick="expand_table0();"><em>click to expand</em></h3>
<h3 id="header0" style="opacity:0.5;display:none;"><em>click a column header to sort</em></h3>
<table border="2" class="sortable" width=70% style="display:none;" id="table0">
  <thead>
    <tr>
      <th>Country</th>
      <th>Title</th>
      <th>Author(s)</th>
    </tr>
  </thead>
  <tbody id="completed-table"></tbody>
</table>

<br><br>
<h2>In my reading queue:</h2>
<h3 id="expand1" style="opacity:0.5;" onclick="expand_table1();"><em>click to expand</em></h3>
<h3 id="header1" style="opacity:0.5;display:none;"><em>click a column header to sort</em></h3>
<table border="2" class="sortable" width=70% style="display:none;" id="table1">
  <thead>
    <tr>
      <th>Country</th>
      <th>Title</th>
      <th>Author(s)</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody id="recommendations-table"></tbody>
</table>

<br><br><br>

<a href="http://paulkaefer.com/">Home</a>

</center>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/queue.v1.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
<script src="d3-tip.js"></script>
<script>

    /* change page theme based on scaled day of year: */
    function set_theme_color() {
        var meta_element = document.getElementsByClassName("mobile_tab_color");

        var d = new Date();
        var red = Math.floor(d.getMonth() * 256 / 12);
        var green = Math.floor(d.getDate() * 256 / 31);
        var blue = Math.floor((d.getYear() - 100) * 256 / 100);

        meta_element[0].content = "#" + red.toString(16) + green.toString(16) + blue.toString(16);
    }

    set_theme_color();

    var format = d3.format(",");

    // Set tooltips
    var tip = d3.tip()
                .attr('class', 'd3-tip')
                .offset([-10, 0])
                .html(function(d) {
                  return "<strong>Country: </strong><span class='details'>" + d.properties.name + "<br></span>" + "<strong>Book(s): </strong><span class='details'>" + d.book +"</span>";
                })

    var margin = {top: -250, right: 0, bottom: 0, left: 100},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

    /*var color = d3.scaleThreshold()
        .domain([10000,100000,500000,1000000,5000000,10000000,50000000,100000000,500000000,1500000000])
        .range(["rgb(247,251,255)", "rgb(222,235,247)", "rgb(198,219,239)", "rgb(158,202,225)", "rgb(107,174,214)", "rgb(66,146,198)","rgb(33,113,181)","rgb(8,81,156)","rgb(8,48,107)","rgb(3,19,43)"]);*/
    var color = ["rgb(0, 0, 0)", "rgb(255, 0, 0)", "rgb(0, 0, 255)", "rgb(128, 0, 128)"]

    var path = d3.geoPath();

    var svg = d3.select("map")
                .append("svg")
                .attr("style", "border: 5px solid gold;")
                .attr("width", width)
                .attr("height", height)
                .append('g')
                .attr('class', 'map');

    var projection = d3.geoMercator()
                       .scale(130)
                      .translate( [width / 2, height / 1.5]);

    var path = d3.geoPath().projection(projection);

    svg.call(tip);

    queue()
        .defer(d3.json, "world_countries.json")
        /*.defer(d3.tsv, "world_population.tsv")*/
        .defer(d3.csv, "read_the_world.csv")
        .await(ready);

    function ready(error, data, book_list) {
      //console.log(book_list);
      var bookList = {};
      var colors = {};
      var countries_and_codes = {};

      var completed_table = d3.select("#completed-table");
      var recommendations_table = d3.select("#recommendations-table");

      book_list.forEach(function(d) {
        /* hacky, but ensure colors are initialized by country;
           in the case of having read multiple books, I want the "max" color to persist */
        if ( (colors[d.id] == null) || (colors[d.id] == NaN) ) {
            colors[d.id] = 0;
        }
        if (bookList[d.id] == null) {
            bookList[d.id] = "";
        }

        if (d.Read == 1) {
            bookList[d.id] += "&bull; <em>" + d.Book + "</em>, by " + d.Author + "<br>";

            if (d.visited_country == 1) {
                /* purple: red + blue */
                colors[d.id] = Math.max(3, colors[d.id]);
            } else {
                /* red since I "read" the book */
                colors[d.id] = Math.max(1, colors[d.id]);
            }
            /* this works: */
            //console.log("I've read " + bookList[d.id] + " from " + d.Country);

            var row = completed_table.append("tr");
            
            var cell = row.append("td");
            cell.text(d.Country);
            
            var cell = row.append("td");
            var book = cell.append("em");
            book.text(d.Book);

            var cell = row.append("td");
            cell.text(d.Author);
        } else {
            /* only append a row if a book is found: */
            if (d.Book) {
                var row = recommendations_table.append("tr");

                var cell = row.append("td");
                cell.text(d.Country);

                var cell = row.append("td");
                var book = cell.append("em");
                book.text(d.Book);

                var cell = row.append("td");
                cell.text(d.Author);

                var cell = row.append("td");
                cell.text(d.Notes);
            }
        }
        
          
        if ((d.Read == 0) && (d.visited_country == 1)) {
            /* blue */
            colors[d.id] = Math.max(2, colors[d.id]);
        }
      });
      /* this also works: */
      /*console.log(bookList);*/

      data.features.forEach(function(d) { d.book = bookList[d.id] });

     /*console.log(data);*/

        // for adding three-digit codes to csv:
     /*data.features.forEach(d => console.log(d.id + " "  + d.properties.name));
     console.log(countries_and_codes);*/

        /*svg.append("text").attr("x", 250).attr("y", 25).text("Hover for country names and books!").style("font-size", "20px").style("font-family", "Helvetica").style("opacity", "0.5").attr("alignment-baseline","middle")*/

        svg.append("circle").attr("cx",20).attr("cy",30).attr("r", 6).style("fill", "#FF0000")
        svg.append("circle").attr("cx",20).attr("cy",60).attr("r", 6).style("fill", "#0000FF")
        svg.append("circle").attr("cx",20).attr("cy",90).attr("r", 6).style("fill", "#800080")
        svg.append("text").attr("x", 40).attr("y", 30).text("Read a book").style("font-size", "15px").style("font-family", "Helvetica").attr("alignment-baseline","middle")
        svg.append("text").attr("x", 40).attr("y", 60).text("Visited the country").style("font-size", "15px").style("font-family", "Helvetica").attr("alignment-baseline","middle")
        svg.append("text").attr("x", 40).attr("y", 90).text("Both").style("font-size", "15px").style("font-family", "Helvetica").attr("alignment-baseline","middle")

      /* draw countries */
      svg.append("g")
          .attr("class", "countries")
        .selectAll("path")
          .data(data.features)

        .enter().append("path")
          .attr("d", path)
          .style("fill", function(d) { return color[colors[d.id]]; })
          .style('stroke', 'white')
          .style('stroke-width', 1.5)
          .style("opacity",0.8)

          // tooltips
          .style("stroke","white")
          .style('stroke-width', 0.3)
          .on('mouseover',function(d){
            tip.show(d);

            d3.select(this)
              .style("opacity", 1)
              .style("stroke","white")
              .style("stroke-width",3);
          })
          .on('mouseout', function(d){
            tip.hide(d);

            d3.select(this)
              .style("opacity", 0.8)
              .style("stroke","white")
              .style("stroke-width",0.3);
          });

      svg.append("path")
         .datum(topojson.mesh(data.features, function(a, b) { return a.id !== b.id; }))
         .attr("class", "names")
         .attr("d", path);
    }
    
    function expand_table0() {
        d3.select("#expand0").remove();
        
        d3.select("#header0").style("display", "");
        d3.select("#table0").style("display", "");
    }
    
    function expand_table1() {
        d3.select("#expand1").remove();
        
        d3.select("#header1").style("display", "");
        d3.select("#table1").style("display", "");
    }

</script>

</body>
</html>
